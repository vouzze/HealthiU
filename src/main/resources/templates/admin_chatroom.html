<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
    <meta charset="UTF-8">
    <title>Insert title here</title>
    <link th:href="@{/webjars/bootstrap/css/bootstrap.min.css}" rel="stylesheet" type="text/css">
    <link th:href="@{/css/style.css}" rel="stylesheet" type="text/css">
    <script th:src="@{/webjars/jquery/jquery.min.js}"></script>
    <script th:src="@{/webjars/sockjs-client/sockjs.min.js}"></script>
    <script th:src="@{/webjars/stomp-websocket/stomp.min.js}"></script>
</head>
<body>
<h1>Chatroom requests</h1>
<div class="chat_window">
    <div class="top_menu">
        <div class="buttons">
            <div class="button close"></div>
            <div class="button minimize"></div>
            <div class="button maximize"></div>
        </div>
        <div class="title">Chat</div>
    </div>
    <p>User requests:</p>
    <ul class="user_requests"></ul>
    <hr>
    <p>Doctor requests:</p>
    <ul class="doctor_requests"></ul>

    <div class="bottom_wrapper clearfix">
        <div class="user_login_input_wrapper">
            <input id="user_login_input_value" class="user_login_input" placeholder="User login"/>
            <input id="doctor_login_input_value" class="doctor_login_input" placeholder="Doctor login"/>
        </div>

        <button onclick="addChatRoom()" class="text">Create Chat Room</button>
        <p id="chat_room_invalid" style="display: none">Chat Room can't be created</p>
    </div>
</div>
<div id="user_request_template" class="user_request_template">
    <li class="user_request">
        <div class="text_wrapper">
            <div class="user_request_text"></div>
        </div>
    </li>
</div>

<div id="doctor_request_template" class="doctor_request_template">
    <li class="doctor_request">
        <div class="text_wrapper">
            <div class="doctor_request_text"></div>
        </div>
    </li>
</div>

<script th:inline="javascript">
    $('.user_requests').empty();
    let userRequestList = [[${userRequestList}]];
    if (userRequestList !== null) {
        for (let i = 0; i < userRequestList.length; i++) {
            drawUserRequest(userRequestList[i]);
        }
    }

    $('.doctor_requests').empty();
    let doctorRequestList = [[${doctorRequestList}]];
    if (doctorRequestList !== null) {
        for (let i = 0; i < doctorRequestList.length; i++) {
            drawDoctorRequest(doctorRequestList[i]);
        }
    }

    function drawUserRequest(userLogin) {
        var $user_request;
        $user_request = $($('.user_request_template').clone().html());
        $user_request.addClass('user_request_style').find('.user_request_text').html(userLogin);
        console.log(userLogin);
        $('.user_requests').append($user_request);
    }

    function drawDoctorRequest(doctorLogin) {
        var $doctor_request;
        $doctor_request = $($('.doctor_request_template').clone().html());
        $doctor_request.addClass('doctor_request_style').find('.doctor_request_text').html(doctorLogin);
        console.log(doctorLogin);
        $('.doctor_requests').append($doctor_request);
    }

    function addChatRoom() {
        $.ajax({
            type: "GET",
            url: "/chatroom/admin/add-chatroom/" + $('#user_login_input_value').val() + "/" + $('#doctor_login_input_value').val(),
            success: function () {
                console.log("success")
                $('#chat_room_invalid').css('display', 'none');
                window.location.reload()
            },
            error: function () {
                console.log("error")
                $('#chat_room_invalid').css('display', 'block');
            }
        });
    }
</script>
</body>
</html>